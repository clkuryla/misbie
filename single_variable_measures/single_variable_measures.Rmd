---
title: "Single Variable Measures"
author: "Christine Lucille Kuryla"
date: "2024-02-22"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)

```

# Introduction

## MiSBIE Data Background

See "misbie_explore.Rmd" for more details about the variables and some EDA. 

*tl;dr:* There are three groups: healthy, mutation, and deletion. The mutation and deletion groups are subjects with genetic mitochondrial abnormalities. Continuous heart rate, respiration rate, and blood pressure measures were recorded for 71 subjects over several tasks and recovery periods.

Note the raw data allows for HR and RR to be analyzed independent of rate because the raw data is each systole/diastole beat and each inspiration/expiration, respectively. Rate can be calculated per interval or may be interpolated. 

## Objective

This Rmd will explore various complexity measures from single variables (heart rate, blood pressure, or respiration rate) over time. 











# Load and process data

```{r load_data}

# For now, we will focus on heart rate.

hr_cleaned <- read_csv("./data/data_from_email/hr_cleaned.csv")
#bp_cleaned <- read_csv("./data/data_from_email/bp_cleaned.csv")
#rsp_cleaned <- read_csv("./data/data_from_email/rsp_cleaned.csv")
#pt_cond_cleaned <- read_csv("./data/data_from_email/patient condition.csv")

# Sample size
length(unique(hr_cleaned))
length(unique(bp_cleaned))
length(unique(rsp_cleaned))

hr_cleaned %>%
  group_by(condition) %>%
  summarise(UniqueSubjects = n_distinct(id)) 

# Clean up the data and add column for time between beats
hr_cleaned_final <- hr_cleaned %>% 
  filter(condition %in% c("Control", "Deletion", "Mutation")) %>% 
  mutate(rate = ifelse(rate > 150 | rate < 25, NA, rate)) %>% #Replace with NA if HR is > 150 or < 25 
  mutate(delta_t  = pSec - lag(pSec)) %>% 
  mutate(delta_t = ifelse(delta_t > 5 | delta_t < -5, NA, delta_t)) # get rid of the first data point (lag) and the unreasonable data points
  

hr_df <- hr_cleaned_final

rm(hr_cleaned_final)

# for future use
id_cond_df <- hr_df %>% 
  select(id, condition) %>% 
  unique()

```

# Heart Rate

## SD (just for fun)

```{r hr_sd, eval = FALSE}

rmssd <- function(data_delta_t){
  sq <- data_delta_t^2
  avgofsq <- mean(sq)
  rmssd <- sqrt(avgofsq)
  return(rmssd)
}

#test_rmssd <- function(data){
  # need to be in ms?
#  delta_t_squared <- data %>% mutate(delta_t_squared = (delta_t)^2)
#  avg_of_squared <- delta_t_squared %>% na.omit() %>% group_by(id, period) %>% summarize(mean_of_sq_dt = mean(delta_t_squared))
#  rmssd <- sqrt(mean_of_sq_dt)
#}

# Just for one

hr_summary <- hr_df %>% 
  group_by(id, period) %>% 
  na.omit() %>% 
  summarize(hr_dt_mean = mean(delta_t),
            hr_dt_sd = sd(delta_t),
            hr_rmssd = rmssd(delta_t)) %>% 
  ungroup() %>% 
  left_join(id_cond_df, by = "id") %>% 
  mutate(condition = as.factor(condition))

hist(hr_summary$hr_dt_sd)
hist(hr_summary$hr_dt_mean)
hist(hr_summary$hr_rmssd)


# t-test for hr delta t sd
t.test(data = hr_summary %>% filter(condition == "Control" | condition == "Mutation"), hr_dt_sd ~ condition)
t.test(data = hr_summary %>% filter(condition == "Control" | condition == "Deletion"), hr_dt_sd ~ condition)
t.test(data = hr_summary %>% filter(condition == "Mutation" | condition == "Deletion"), hr_dt_sd ~ condition)

# t-test for hr delta t mean
t.test(data = hr_summary %>% filter(condition == "Control" | condition == "Mutation"), hr_dt_mean ~ condition)
t.test(data = hr_summary %>% filter(condition == "Control" | condition == "Deletion"), hr_dt_mean ~ condition)
t.test(data = hr_summary %>% filter(condition == "Mutation" | condition == "Deletion"), hr_dt_mean ~ condition)

# t-test for hr rmssd
t.test(data = hr_summary %>% filter(condition == "Control" | condition == "Mutation"), hr_rmssd ~ condition)
t.test(data = hr_summary %>% filter(condition == "Control" | condition == "Deletion"), hr_rmssd ~ condition)
t.test(data = hr_summary %>% filter(condition == "Mutation" | condition == "Deletion"), hr_rmssd ~ condition)

```


## https://cran.r-project.org/web/packages/fractalRegression/fractalRegression.pdf 

## Multiscale Entropy (MSE)

```{r}


```

